# 高级商品筛选组件库 (Advanced SKU/SPU Filter) 产品需求文档

| 文档版本 | 修改日期   | 修改人      | 备注                             |
| :------- | :--------- | :---------- | :------------------------------- |
| v1.0     | 2026-01-31 | Antigravity | 初稿创建，基于现有 Demo 逆向梳理 |

## 1. 产品概述 (Product Overview)

### 1.1 背景 (Background)

在电商后台、ERP 及进销存系统中，商品（SPU/SKU）的筛选是最频繁的操作之一。传统的下拉选择器存在以下痛点：

1. **信息密度低**：仅显示名称，无法直观判断商品状态（如库存不足、缺失图片）。
2. **筛选逻辑单一**：通常仅支持“包含”，缺乏“排除”或“空值”筛选能力，导致报表分析场景受限。
3. **交互体验差**：在选中大量数据时，输入框被撑大破坏布局，且无法快速预览已选项详情。

### 1.2 目标 (Objective)

构建一套**高性能、高交互、可配置**的通用筛选组件库，首期包含 `BaseFilter`（内核）、`SPUFilter` 和 `SKUFilter` 三个组件。旨在提升 B 端用户在复杂数据检索场景下的效率与体验。

---

## 2. 核心功能架构 (Core Architecture)

产品采用 **原子化设计 (Atomic Design)** 思想：

- **Level 1 (BaseFilter)**: 处理通用的交互逻辑（弹窗、搜索、模式切换、多选、分页）。
- **Level 2 (Business Filters)**: 基于 BaseFilter 封装业务逻辑，注入特定的渲染模版（Render Props）和数据源（SKU/SPU Data）。

---

## 3. 功能需求详情 (Functional Requirements)

### 3.1 通用筛选器内核 (BaseFilter)

这是所有业务筛选器的基石，需具备以下能力：

#### 3.1.1 多模式筛选逻辑 (Filter Modes)

用户需能够定义筛选集合的逻辑关系，不仅仅是“选中即查询”。

- **包含 (Include)**: 默认模式。查询结果包含选中项。
  - *UI表现*: 蓝色边框/文字。
- **不包含 (Exclude)**: 排除式查询。查询结果不包含选中项。
  - *UI表现*: 红色边框/文字，强警示。
- **为空 (Is Empty)**: 筛选该字段为空的数据（如“筛选没有关联供应商的SKU”）。
  - *交互*: 此时禁用输入框和下拉选择，仅作为一个开关状态。
- **不为空 (Is Not Empty)**: 筛选该字段有值的数据。

#### 3.1.2 智能搜索与分页 (Smart Search & Pagination)

- **防抖搜索 (Debounce)**: 输入关键词 300ms 后触发搜索，减少接口压力。
- **关键词高亮 (Highlight)**: 在下拉列表中，即时高亮匹配的字符串片段（支持中英文）。
- **滚动加载 (Infinite Scroll)**: 下拉列表触底自动加载下一页数据。
- **异步 Loading 状态**: 清晰的加载中动画反馈。

#### 3.1.3 高级回显与折叠 (Advanced Tags Display)

- **数量限制**: 仅展示前 N 个（如 3 个）选中项，其余收纳为 `+N` 胶囊。
- **展开浮层**: 鼠标 Hover 到 `+N` 标时，展示完整的选中项列表，支持在浮层中快速删除。
- **详情预览**: 鼠标 Hover 到任意选中标签（Tag）上时，触发**详情预览卡片 (Popover)**，展示该选项的元数据（如图片、完整编码等）。

#### 3.1.4 批量操作 (Batch Actions)

- **智能全选**:
  - **全选当前页/搜索结果**: 一键选中当前列表所有项。
  - **逻辑互斥**: 若当前处于搜索状态，提示用户是“全选搜索结果”还是“全选所有”。
- **一键清空**: 快速重置所有选中项。

---

### 3.2 业务组件：SPU 筛选器 (SPUFilter)

#### 3.2.1 数据展示维度

- **核心信息**: SPU 编码、中文名称、英文名称。
- **扩展信息**: SPU 产品图、关联 SKU 数量 (SKU Count)。

#### 3.2.2 特性配置

- **图片开关**: 可配置是否在列表中显示 SPU 缩略图。
- **SKU 计数**: 直观展示该 SPU 下包含多少个 SKU，辅助判断商品规格复杂度。

#### 3.2.3 详情卡片内容

- 大图展示（适应正方形）。
- SPU 编码（支持长文本换行/截断处理）。
- 关联 SKU 统计。

---

### 3.3 业务组件：SKU 筛选器 (SKUFilter)

#### 3.3.1 数据展示维度

- **核心信息**: SKU 编码、中文名称、英文名称、所属 SPU 编码。
- **状态信息**: 可用库存 (Available Stock)、封面图。

#### 3.3.2 智能预警逻辑

- **低库存预警**: 当库存 < 100（阈值可配）时，库存数字显示为**橙色**或**红色**。
- **无图预警**: 若无图片，显示默认占位图并标记“未上传”，提示运营补全信息。

#### 3.3.3 详情卡片内容

- 强调 SKU 编码和库存状态。
- 显示所属 SPU 信息，方便溯源。
- 商品详细规格参数（名称/描述）。

---

## 4. UI/UX 交互规范 (Interaction Guidelines)

### 4.1 弹窗自适应

- **智能定位**: 详情卡片 (Preview Card) 应根据屏幕剩余空间，自动判断向**左侧**还是**右侧**弹出，避免内容超出视口。

### 4.2 状态反馈

- **Hover 效果**:
  - 列表项 Hover 时显示浅蓝色背景 (`bg-blue-50`)。
  - 选中项 Hover 时显示详情卡片。
- **选中状态**:
  - 列表项右侧显示对勾图标。
  - 背景色加深。
- **禁用状态**:
  - 当筛选模式为“为空/不为空”时，输入框置灰，禁止输入和下拉。

### 4.3 动画体验

- 使用微动画（Micro-interactions）提升精致感：
  - 下拉菜单展开/收起时的淡入淡出。
  - 标签删除时的消失动画。
  - 详情卡片的缩放出现 (`zoom-in`).

---

## 5. 接口定义 (API Requirements)

### 5.1 通用查询参数

组件通过 `onSearch` 和 `onLoadMore` 与父组件通信，预期接口参数如下：

```typescript
interface SearchParams {
  query: string;      // 搜索关键词
  page: number;       // 当前页码
  pageSize: number;   // 每页数量
}
```

### 5.2 数据结构 (Models)

**SPU Item**

```typescript
interface SPUItem {
  id: string;
  spuCode: string;
  nameZh: string;
  nameEn: string;
  imageUrl?: string;
  skuCount: number;
}
```

**SKU Item**

```typescript
interface SKUItem {
  id: string;
  code: string;
  nameZh: string;
  nameEn: string;
  spuCode: string;
  imageUrl?: string;
  availableStock: number;
}
```

---

## 6. 未来规划 (Roadmap)

### v1.1 性能优化

- **虚拟滚动 (Virtual Scroll)**: 针对超过 1000 条数据的列表，引入虚拟滚动技术，降低 DOM 节点数量，提升渲染性能。

### v1.2 功能增强

- **键盘导航 (A11y)**: 完善 `Tab` 键切换焦点、上下键选择、回车键确认的键盘交互流程。
- **粘贴批量搜索**: 支持用户直接粘贴一串逗号分隔的 SKU 编码，组件自动识别并选中对应项（Excel 友好模式）。

### v1.3 移动端适配

- 针对移动端 H5 场景，将下拉弹窗调整为底部抽屉 (Bottom Sheet) 模式，提升触控体验。
